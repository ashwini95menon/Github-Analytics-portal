import requests
import csv
import datetime

username = "amenon2"
token = "1eb20c64f34b8ca37ca9c2e2305605bab7b4c4c2"

username = "ashwini95menon"

token = "0f10ca525a26da9ec86a8471b9473f4c7398c849"

sesn=requests.session()


class IssuesDrill:
    def __init__(self):
        self.urls = []

    @staticmethod
    def list_all_issues(usr, urls):
        for repo in urls:
            #usr = url.split("/")[-2]
            #repo = url.split("/")[-1]
            url1 = "http://api.github.com/repos/" + usr + "/" + repo + "/issues?state=closed"
            #url = "https://api.github.ncsu.edu/repos/adhaval/csc510-project/issues?state=closed"
            count_iss = 1
            number=[]
            names=[]
            createdat=[]
            closedat=[]
            closedby=[]
            repository = []
            authenticatn = sesn.get(url1, auth=(username, token))

            print("Task 1")
            print("list of issues fixed:")
            print(authenticatn)
            for list_issues in authenticatn.json():
                print(list_issues)
                print ("...")
                number.append(list_issues['number'])
                names.append(list_issues['title'].encode('utf-8'))
                createdat.append(list_issues['created_at'].encode('utf-8'))
                closedat.append(list_issues['closed_at'].encode('utf-8'))
                closedby.append(list_issues['user']['login'].encode('utf-8'))
                repository.append(repo)



            issuedata=list(zip(number,names,repository,createdat,closedat,closedby))

            open('data_gen/issues_%s.csv' % repo, 'w').close()
            myfile = open("data_gen/issues_%s.csv" % repo, "w")
            with myfile:
                writer = csv.writer(myfile)
                writer.writerows(issuedata)

            count_iss += 1
            return issuedata
        #print("IssuesDrill accessed on " + str(datetime.now()))
#if __name__=="__main__":
#    list_all_issues()

#ids = IssuesDrill(["https://github.com/IBM/mi-prometheus", "https://github.com/AmeyaDhavalikar/BRep"])
#ids.list_all_issues(["https://github.com/IBM/mi-prometheus", "https://github.com/AmeyaDhavalikar/BRep"])